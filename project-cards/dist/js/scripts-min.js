const btnLogin=document.querySelector(".btn-login"),NUMBER_CHILD_CARDS_BOARD=2;let tempPositionShowMore=0,tempPositionEdit=0;class Modal{constructor(e){this._modalViewLogin=document.querySelector(".login-container"),this._modalViewCreateVisit=document.querySelector(".create-visit-container"),this._btnClose=document.querySelectorAll(".btn-close"),this._btnModalLogin=document.querySelector(".form-login__btn-confirm"),this._inputEmail=document.querySelector(".form-login__input-login"),this._inputPassword=document.querySelector(".form-login__input-password"),this._errorText=document.querySelector(".form-login__text-error"),this._selectDoctor=document.querySelector(".form-visit_types-doctor"),this._cardiologistModalView=document.querySelector(".info-form__cardiologist-info"),this._dentistModalView=document.querySelector(".info-form_dentist-info"),this._therapistModalView=document.querySelector(".info-form_therapist-info"),this._btnAddCard=document.querySelector(".form-visit__confirm-btn"),this._token="",this.btnLogin=e}showModalView(){""===this._token?this._modalViewLogin.classList.add("login-container--active"):(console.log("open +"),this._modalViewCreateVisit.classList.add("create-visit-container--active"))}removeModalView(){""===this._token?(this._modalViewLogin.classList.remove("login-container--active"),this._inputEmail.value="",this._inputPassword.value=""):this._modalViewCreateVisit.classList.remove("create-visit-container--active")}modalLogin(){this._btnModalLogin.addEventListener("click",e=>{""!==this._inputEmail.value.trim()&&""!==this._inputPassword.value.trim()?(this.getToken(this._inputEmail.value,this._inputPassword.value),this._errorText.classList.remove("form-login__text-error--active")):""===this._inputEmail.value.trim()&&""===this._inputPassword.value.trim()?(this._errorText.innerText="Please enter your email and password",this._errorText.classList.add("form-login__text-error--active")):""!==this._inputEmail.value.trim()&&""===this._inputPassword.value.trim()?(this._errorText.innerText="Please enter your email",this._errorText.classList.add("form-login__text-error--active")):""===this._inputEmail.value.trim()&&""!==this._inputPassword.value.trim()&&(this._errorText.innerText="Please enter your password",this._errorText.classList.add("form-login__text-error--active"))})}getToken(e,t){fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}).then(e=>{if(e.ok)return this.removeModalView(),this.btnLogin.innerText="Create a visit",e.text();401===e.status&&(this._errorText.innerText="Incorrect username or password",this._errorText.classList.add("form-login__text-error--active"))}).then(e=>{this._token=e,this.renderAllCard(e)})}switchDoctorsInfo(){let e=0;this._selectDoctor.addEventListener("change",t=>{switch(e){case 0:this._cardiologistModalView.classList.remove("info-form__cardiologist-info--active");break;case 1:this._dentistModalView.classList.remove("info-form_dentist-info--active");break;case 2:this._therapistModalView.classList.remove("info-form_therapist-info--active")}switch(t.target.selectedIndex){case 0:e=t.target.selectedIndex,this._cardiologistModalView.classList.add("info-form__cardiologist-info--active");break;case 1:e=t.target.selectedIndex,this._dentistModalView.classList.add("info-form_dentist-info--active");break;case 2:e=t.target.selectedIndex,this._therapistModalView.classList.add("info-form_therapist-info--active")}})}createCard(){const e=document.querySelector(".main-info__full-name").value.trim(),t=document.querySelector(".main-info__visit-purpose").value.trim(),i=document.querySelector(".main-info__visit-description").value.trim(),s=document.querySelector(".chose-priority__visit-priority"),r=s.options[s.selectedIndex].text,o=document.querySelector(".cardiologist-info__age").value.trim(),a=document.querySelector(".cardiologist-info__body-mass-index").value.trim(),n=document.querySelector(".cardiologist-info__normal-pressure").value.trim(),c=document.querySelector(".cardiologist-info__past-diseases").value.trim(),d=document.querySelector(".dentist-info__date").value.trim(),l=document.querySelector(".therapist-info__age").value.trim();switch(this._selectDoctor.selectedIndex){case 0:new VisitCardiologist(e,t,i,r,o,a,n,c).createCardiologistCard(this._token);break;case 1:new VisitDentist(e,t,i,r,d).createDentistCard(this._token);break;case 2:new VisitTherapist(e,t,i,r,l).createTherapistCard(this._token);break}this.removeModalView()}renderAllCard(e){fetch("https://ajax.test-danit.com/api/v2/cards",{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then(e=>e.json()).then(t=>{if(0!==t.length){this.car,t.forEach(e=>{switch(e.doctor){case"Cardiologist":new VisitCardiologist(e.name,e.purpose,e.description,e.priority,e.age,e.weight,e.bp,e.diseases).render(this._token,e.id);break;case"Dentist":{const t=new VisitDentist(e.name,e.purpose,e.description,e.priority,e.date);console.log(e),t.render(this._token,e.id);break}case"Therapist":new VisitTherapist(e.name,e.purpose,e.description,e.priority,e.age).render(this._token,e.id);break}});const i=document.querySelector(".btn-start-search"),s=new Filter;i.addEventListener("click",t=>{fetch("https://ajax.test-danit.com/api/v2/cards",{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then(e=>e.json()).then(t=>{s.filterBySearch(e,t,s)})})}})}createModalView(){this.btnLogin.addEventListener("click",e=>{console.log("open"),this.showModalView()}),this._btnClose.forEach(e=>{e.addEventListener("click",e=>{this.removeModalView()})}),this._btnAddCard.addEventListener("click",e=>{this.createCard()}),document.addEventListener("click",e=>{switch(console.log(e.target.className.split(" ")[0]),e.target.className.split(" ")[0]){case"create-visit-container":document.querySelector(".create-visit-container--active").classList.remove("create-visit-container--active");break;case"create-edit-container":document.querySelector(".create-edit-container--active").classList.remove("create-edit-container--active");break;case"create-show-more-container":document.querySelector(".create-show-more-container--active").classList.remove("create-show-more-container--active");break;case"login-container":document.querySelector(".login-container--active").classList.remove("login-container--active")}}),this.modalLogin(),this.switchDoctorsInfo()}}let modal=new Modal(btnLogin);modal.createModalView();class Visit{constructor(e,t,i,s){this.fullName=e,this.visitPurpose=t,this.shortDescription=i,this.priority=s,this.cardBoard=document.querySelector(".cards-container__box"),this.textEmpty=document.querySelector(".text-empty"),this.card=document.querySelector(".box__card").cloneNode(!0),this.cardFullName=this.card.querySelector(".card__full-name"),this.cardDoctor=this.card.querySelector(".card__doctor"),this.cardClose=this.card.querySelector(".card-close"),this.btnShowMore=this.card.querySelector(".card__btn-more"),this.showMoreContainer=document.querySelector(".create-show-more-container"),this.btnEdit=this.card.querySelector(".card__btn-edit"),this.editContainer=document.querySelector(".create-edit-container"),this.btnSaveEdit=document.querySelector(".form-edit__confirm-btn"),this.fullNameInput=this.editContainer.querySelector(".main-info__full-name"),this.visitPurposeInput=this.editContainer.querySelector(".main-info__visit-purpose"),this.shortDescriptionTextArea=this.editContainer.querySelector(".main-info__visit-description"),this.prioritySelect=this.editContainer.querySelector(".chose-priority__visit-priority")}render(e,t){this.textEmpty.classList.remove("text-empty--active"),this.cardBoard.classList.remove("cards-container__box--empty"),this.card.classList.remove("box__card--original"),this.cardFullName.innerHTML=this.cardFullName.innerHTML+this.fullName,this.cardClose.addEventListener("click",i=>{this.delCard(e,t)}),this.btnShowMore.addEventListener("click",e=>{this.showMoreCard()}),this.btnEdit.addEventListener("click",i=>{this.editCard(e,t)})}delCard(e,t){fetch(`https://ajax.test-danit.com/api/v2/cards/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),document.getElementById(`${t}`).remove(),this.cardBoard.children.length===NUMBER_CHILD_CARDS_BOARD&&(this.cardBoard.classList.add("cards-container__box--empty"),this.textEmpty.classList.add("text-empty--active"))}showMoreCard(){const e=this.showMoreContainer.querySelector(".main-info__full-name"),t=this.showMoreContainer.querySelector(".main-info__visit-purpose"),i=this.showMoreContainer.querySelector(".main-info__visit-description"),s=this.showMoreContainer.querySelector(".chose-priority__visit-priority"),r=this.showMoreContainer.querySelector(".box__btn-show-more"),o=this.showMoreContainer.querySelector(".info-form__cardiologist-info"),a=this.showMoreContainer.querySelector(".info-form_dentist-info"),n=this.showMoreContainer.querySelector(".info-form_therapist-info");switch(e.value=this.fullName,t.value=this.visitPurpose,i.value=this.shortDescription,s.value=this.priority,r.addEventListener("click",e=>{this.showMoreContainer.classList.remove("create-show-more-container--active")}),this.showMoreContainer.classList.add("create-show-more-container--active"),tempPositionShowMore){case 0:o.classList.remove("info-form__cardiologist-info--active");break;case 1:a.classList.remove("info-form_dentist-info--active");break;case 2:n.classList.remove("info-form_therapist-info--active")}switch(this.cardDoctor.innerText.split(":")[1]){case"Cardiologist":tempPositionShowMore=0,o.classList.add("info-form__cardiologist-info--active");break;case"Dentist":tempPositionShowMore=1,a.classList.add("info-form_dentist-info--active");break;case"Therapist":tempPositionShowMore=2,n.classList.add("info-form_therapist-info--active")}}editCard(e,t){const i=this.editContainer.querySelector(".box__btn-edit"),s=this.editContainer.querySelector(".info-form__cardiologist-info"),r=this.editContainer.querySelector(".info-form_dentist-info"),o=this.editContainer.querySelector(".info-form_therapist-info");switch(this.fullNameInput.value=this.fullName,this.visitPurposeInput.value=this.visitPurpose,this.shortDescriptionTextArea.value=this.shortDescription,this.prioritySelect.value=this.priority,i.addEventListener("click",e=>{this.editContainer.classList.remove("create-edit-container--active")}),this.editContainer.classList.add("create-edit-container--active"),tempPositionEdit){case 0:s.classList.remove("info-form__cardiologist-info--active");break;case 1:r.classList.remove("info-form_dentist-info--active");break;case 2:o.classList.remove("info-form_therapist-info--active")}switch(this.cardDoctor.innerText.split(":")[1]){case"Cardiologist":tempPositionEdit=0,s.classList.add("info-form__cardiologist-info--active");break;case"Dentist":tempPositionEdit=1,r.classList.add("info-form_dentist-info--active");break;case"Therapist":tempPositionEdit=2,o.classList.add("info-form_therapist-info--active")}}}class VisitCardiologist extends Visit{constructor(e,t,i,s,r,o,a,n){super(e,t,i,s),this._id,this.age=r,this.bodyMass=o,this.normalPressure=a,this.cardiovascularDiseases=n}createCardiologistCard(e){fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:this.fullName,purpose:this.visitPurpose,description:this.shortDescription,priority:this.priority,doctor:"Cardiologist",age:this.age,weight:this.bodyMass,bp:this.normalPressure,diseases:this.cardiovascularDiseases})}).then(e=>e.json()).then(t=>{this._id=t.id,this.render(e)})}render(e,t=this._id){super.render(e,t),this.card.setAttribute("id",t),this.cardDoctor.innerHTML=this.cardDoctor.innerHTML+"Cardiologist",this.cardBoard.append(this.card)}showMoreCard(){super.showMoreCard();const e=this.showMoreContainer.querySelector(".cardiologist-info__age"),t=this.showMoreContainer.querySelector(".cardiologist-info__body-mass-index"),i=this.showMoreContainer.querySelector(".cardiologist-info__normal-pressure"),s=this.showMoreContainer.querySelector(".cardiologist-info__past-diseases");e.value=this.age,t.value=this.bodyMass,i.value=this.normalPressure,s.value=this.cardiovascularDiseases}editCard(e,t=this._id){super.editCard(e,t);const i=this.editContainer.querySelector(".cardiologist-info__age"),s=this.editContainer.querySelector(".cardiologist-info__body-mass-index"),r=this.editContainer.querySelector(".cardiologist-info__normal-pressure"),o=this.editContainer.querySelector(".cardiologist-info__past-diseases");i.value=this.age,s.value=this.bodyMass,r.value=this.normalPressure,o.value=this.cardiovascularDiseases,this.btnSaveEdit.addEventListener("click",a=>{fetch(`https://ajax.test-danit.com/api/v2/cards/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:this.fullNameInput.value,purpose:this.visitPurposeInput.value,description:this.shortDescriptionTextArea.value,priority:this.prioritySelect.value,doctor:"Cardiologist",age:i.value,weight:s.value,bp:r.value,diseases:o.value})}).then(e=>e.json()).then(e=>console.log(e)),this.fullName=this.fullNameInput.value,this.visitPurpose=this.visitPurposeInput.value,this.shortDescription=this.shortDescriptionTextArea.value,this.priority=this.prioritySelect.value,this.age=i.value,this.bodyMass=s.value,this.normalPressure=r.value,this.cardiovascularDiseases=o.value,this.cardFullName.innerHTML='<span class="card__full-name-label">Full Name:</span>'+this.fullName,this.editContainer.classList.remove("create-edit-container--active")})}}class VisitDentist extends Visit{constructor(e,t,i,s,r){super(e,t,i,s),this._id,this.dateLastVisit=r}createDentistCard(e){fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:this.fullName,purpose:this.visitPurpose,description:this.shortDescription,priority:this.priority,doctor:"Dentist",date:this.dateLastVisit})}).then(e=>e.json()).then(t=>{this._id=t.id,this.render(e)})}render(e,t=this._id){super.render(e,t),this.card.setAttribute("id",t),this.cardDoctor.innerHTML=this.cardDoctor.innerHTML+"Dentist",this.cardBoard.append(this.card)}showMoreCard(){super.showMoreCard(),this.showMoreContainer.querySelector(".dentist-info__date").value=this.dateLastVisit}editCard(e,t){super.editCard(e,t);const i=this.editContainer.querySelector(".dentist-info__date");i.value=this.dateLastVisit,this.btnSaveEdit.addEventListener("click",s=>{fetch(`https://ajax.test-danit.com/api/v2/cards/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:this.fullNameInput.value,purpose:this.visitPurposeInput.value,description:this.shortDescriptionTextArea.value,priority:this.prioritySelect.value,doctor:"Dentist",date:i.value})}).then(e=>e.json()).then(e=>console.log(e)),this.fullName=this.fullNameInput.value,this.visitPurpose=this.visitPurposeInput.value,this.shortDescription=this.shortDescriptionTextArea.value,this.priority=this.prioritySelect.value,this.dateLastVisit=i.value,this.cardFullName.innerHTML='<span class="card__full-name-label">Full Name:</span>'+this.fullName,this.editContainer.classList.remove("create-edit-container--active")})}}class VisitTherapist extends Visit{constructor(e,t,i,s,r){super(e,t,i,s),this._id,this.age=r}createTherapistCard(e){fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:this.fullName,purpose:this.visitPurpose,description:this.shortDescription,priority:this.priority,doctor:"Therapist",age:this.age})}).then(e=>e.json()).then(t=>{this._id=t.id,this.render(e)})}render(e,t=this._id){super.render(e,t),this.card.setAttribute("id",t),this.cardDoctor.innerHTML=this.cardDoctor.innerHTML+"Therapist",this.cardBoard.append(this.card)}showMoreCard(){super.showMoreCard(),this.showMoreContainer.querySelector(".therapist-info__age").value=this.age}editCard(e,t){super.editCard(e,t);const i=this.editContainer.querySelector(".therapist-info__age");i.value=this.age,this.btnSaveEdit.addEventListener("click",s=>{fetch(`https://ajax.test-danit.com/api/v2/cards/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({name:this.fullNameInput.value,purpose:this.visitPurposeInput.value,description:this.shortDescriptionTextArea.value,priority:this.prioritySelect.value,doctor:"Therapist",age:i.value})}).then(e=>e.json()).then(e=>console.log(e)),this.fullName=this.fullNameInput.value,this.visitPurpose=this.visitPurposeInput.value,this.shortDescription=this.shortDescriptionTextArea.value,this.priority=this.prioritySelect.value,this.age=i.value,this.cardFullName.innerHTML='<span class="card__full-name-label">Full Name:</span>'+this.fullName,this.editContainer.classList.remove("create-edit-container--active")})}}class Filter{constructor(){this.prioritySearch=document.querySelector(".filter-priority")}filterByPriority(e,t,i){switch(this.prioritySearch.value){case"all":i.forEach(e=>{e.classList.remove("box__card--hide")});break;case"high":t.forEach(e=>{i.forEach(t=>{+t.id==+e.id&&("high"!==e.priority?t.classList.add("box__card--hide"):t.classList.remove("box__card--hide"))})});break;case"normal":t.forEach(e=>{i.forEach(t=>{+t.id==+e.id&&("normal"!==e.priority?t.classList.add("box__card--hide"):t.classList.remove("box__card--hide"))})});break;case"low":t.forEach(e=>{i.forEach(t=>{+t.id==+e.id&&("low"!==e.priority?t.classList.add("box__card--hide"):t.classList.remove("box__card--hide"))})})}}filterBySearch(e,t,i){const s=document.querySelector(".search-input"),r=[];t.forEach(e=>{console.log(e),e.purpose.includes(s.value.trim())?(document.getElementById(e.id).classList.remove("box__card--hide"),r.push(document.getElementById(e.id))):e.description.includes(s.value.trim())?(document.getElementById(e.id).classList.remove("box__card--hide"),r.push(document.getElementById(e.id))):""===s.value.trim()?(document.getElementById(e.id).classList.remove("box__card--hide"),r.push(document.getElementById(e.id))):document.getElementById(e.id).classList.add("box__card--hide")}),console.log(r),i.filterByPriority(e,t,r)}}